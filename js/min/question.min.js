function askQuestion(){function e(e){return e.correct}function s(){$("#questionPrompt").empty(),$(".answer").remove()}function n(e){if(void 0!==e.text){var s=$("<div>");s.attr("id","questionText"),s.html(e.text),$("#questionPrompt").append(s)}void 0!==e.questionResourceId&&t(e.questionResourceId,"questionResource")}function r(e,s){var n=e.possibleAnswers[s],r=$("<div>");r.attr("answerIndex",s.toString()),r.addClass("answer"),n.correct?r.addClass("correct"):r.addClass("incorrect"),void 0!==n.text&&r.html(n.text),$("#questionScreen").append(r),void 0!==n.resourceId&&t(n.resourceId,"answerResource",s)}function t(e,s,n){var r;for(var t in initObj.resources)if(initObj.resources.hasOwnProperty(t)&&t==e){r=initObj.resources[e];break}var a=$("<div>");if("questionResource"===s?a.attr("id","questionResource"):"answerResource"===s&&(a.addClass("answerResource"),ansText=u.possibleAnswers[n].text),"IMAGE"===r.type){var i=$("<img>");i.attr("src",r.url),i.attr("type",r.mimeType),"questionResource"==s?i.addClass("resourceImageIcon"):null==ansText?i.addClass("answerImageFull"):i.addClass("answerImageHalf"),i.attr("imgIndex",n),a.append(i);var o=$("<img>");o.attr("src",r.url),o.attr("type",r.mimeType),o.addClass("resourceImageBig"),o.attr("id","resourceBig"+n),$("#questionScreen").append(o)}else if("AUDIO"===r.type){var c=$("<audio>");c.attr("src",r.url),c.attr("type",r.mimeType),a.append(c),c.load();var d=$("<div>");$(d).addClass("audioImage"),a.append(d),$(d).click(function(){c[0].play(),$("[answerIndex="+n+"]").toggleClass("ans-selected")})}else if("VIDEO"===r.type){var l=$("<video controls>");l.addClass("resourceVideo");var p=$("<source>");p.attr("src",r.url),p.attr("type",r.mimeType),l.append(p),a.append(l)}"questionResource"===s?$("#questionPrompt").append(a):"answerResource"===s&&$("[answerIndex="+n+"]").append(a)}function a(){$(".answer").click(function(){$(this).toggleClass("ans-selected")})}function i(e,s,n,r){var t=makeAnswer(e,s,n,r);void 0!==t&&answersChosen.push(t),questionIndex==initObj.questions.length-1&&(console.log("sending answers..."),addStudentAnswers(answersChosen,r,function(e){console.log(e)}))}function o(e){var s=u._id,n=u.possibleAnswers[parseInt(e)];console.log(n);var r=0;$("[answerIndex="+e+"]").addClass("ans-correct"),i(s,n,!0,r)}function c(e){l=!1;var s=u._id,n=u.possibleAnswers[parseInt(e)],r=(n.correct,0);n.correct===!1&&$("[answerIndex="+e+"]").addClass("ans-incorrect"),i(s,n,!1,r)}function d(e){e.preventDefault();var s=$("input").val(),n={text:s,correct:!1},r=initObj.questions[questionIndex]._id,t=0;l=!1;for(var a=initObj.questions[questionIndex].possibleAnswers,o=0;o<a.length;o++)if(a[o].text===s){n.correct=!0,l=!0;break}i(r,n,n.correct,t)}var u=initObj.questions[questionIndex];answersChosen=[];var l=!0;if(s(),n(u),"MULTIPLE_CHOICE"===u.type){var p=[],g=u.possibleAnswers.filter(e),m=g[Math.floor(Math.random()*g.length)];p.push(m);for(var v=0;v<u.possibleAnswers.length;v++)r(u,v);a()}else if("SHORT_ANSWER"===u.type){var I=$("<div><form>Answer: <input type='text' name='answer'></form></div>");I.addClass("answer"),I.addClass("blank"),$("#questionScreen").append(I)}else"ALL_THAT_APPLY"===u.type;$("#submit").click(function(){$(".resourceImageBig").remove();for(var e=$(".answer"),s=0;s<e.length;s++){var n=$("[answerindex = '"+s+"']");$(n).hasClass("correct")&&$(n).hasClass("ans-selected")?o(s):$(n).hasClass("incorrect")&&$(n).hasClass("ans-selected")?(c(s),l=!1):$(n).hasClass("correct")&&!$(n).hasClass("ans-selected")&&(c(s),l=!1)}if(1===e.length&&$(e[0]).hasClass("blank")){var r=$(".submitButton");r.click(d)}questionIndex+=1,l===!0?gameFinished(!0):gameFinished(!1),$(this).unbind("click")});var f=!1;$(".resourceImageIcon").click(function(){imgIndex=$(this).attr("imgIndex"),bigImage=document.getElementById("resourceBig"+imgIndex),f===!0?($(bigImage).fadeOut(250),$(bigImage).css("visibility","hidden"),f=!1):($(bigImage).css("visibility","visible"),$(bigImage).fadeIn(250),f=!0)}),$(".resourceImageBig").click(function(){$(this).fadeOut(250),$(this).css("visibility","hidden"),f=!1})}